from langchain import OpenAI, PromptTemplate
from langchain.text_splitter import CharacterTextSplitter
from langchain.chains.summarize import load_summarize_chain
from langchain.docstore.document import Document

llm = OpenAI(temperature=0,
             openai_api_key="",
             max_tokens=2000
             )
# Write a concise summary of the following:
prompt_template = """Write a 1000-character summary of the following:


{text}


CONCISE SUMMARY IN KOREAN:"""
text_splitter = CharacterTextSplitter.from_tiktoken_encoder(
    chunk_size=1500,
    chunk_overlap=0,
)
with open('./text.txt') as f:
    test = f.read()
texts = text_splitter.split_text(test)

PROMPT = PromptTemplate(template=prompt_template, input_variables=["text"])

# texts = [" 신청인은 1995.10.20. A 의원에서 위내시경 검사 결과 만성위염으로 진단받고 2일분의 약을 받아 복용하였으며, 이후 1996.5.25.5.27. 3일간과 1997.3.31. 및 1998.9.24. 동 의원에 내원하여 치료를 받음. 신청인은 1999.5.7. 피신청인의 보험모집인으로부터 TM(Telemarketing) 방식에 의하여 보험 가입을 권유받고 동 일자로 청약을 하여 1999.5.15. 보험계약 1)이 체결됨. 신청인은 1999.5.11.6.1. 기간 중 A 의원에서 통원치료를 받았고 1999.8.20. B 의원에서 위암 확정진단을 받은 후 같은 달 30일 C 병원에 입원하여 다음 달 2일 위아전 절제술()을 시행 받음. 피신청인은 1999.10.6. 신청인이 이 같은 병력이 있음에도 불구하고 이를 고지하지 아니하고 보험계약을 청약하였다는 이유로 본건 보험계약을 해지함. 1) 주요 보장내용 : 1. 암 진단 확정은 : 4천만 원, 2. 뇌졸중 진단 확정은 : 4천만 원, 3. 사망보험금 : 4천만원. "]
# texts = ["(1) 신청인의 주장 피신청인의 보험모집인으로부터 1999. 4월 중순경부터 수차례에 걸쳐 전화로 백화점 VIP 고객만이 가입할 수 있는 상품이라고 보험 가입을 권유받았고, 같은 해 5.7. 보험 계약 청약서를 FA로 받아 작성하여 다시 FA로 송부하였으며 같은 달 15일 피신청인으로부터 보험증권 등을 송부 받았음. 보험청약 4년 전 소화가 잘되지 않아 A 의원에서 의사의 권유에 따라 위내시경 검사를 하였고, 이후 1년에 12일 통원치료를 받은 적은 있으나 약을 장기간 복용하였거나 입원한 사실은 전혀 없음. 당시 담당 의사는 식생활에 조금만 유의하면 별문제가 없다고 하면서 위염 증세는 식생활이 불규칙한 한국 성인이면 흔히 있을 수 있다고 진단 소견을 말하였음. 따라서, 보험청약 약 4년 전에 위내시경검사를 받고 1년에 12일 약을 복용한 사실을 고지하지 아니하였다 하여 보험계약을 해지한 피신청인의 조치는 부당함. (2) 피신청인의 주장 신청인은 1995.10.20. 위내시경검사를 하여 자신이 만성위염의 병력이 있음을 알고 있었고 이후에도 수차례에 걸쳐 병원 치료를 받았음에도 이를 숨기고 보험에 가입하였음. 특히 본건 보험계약 체결 당시(1999.5.15.)에는 위 증상으로 치료 중이었음. 보험계약 청약서 작성에 있어 보험자가 서면으로 질문한 사항은 중요한 사항으로 추정되고 동 사항에 대하여 고지하지 아니하거나 부실의 고지를 한 경우에는 보험자는 계약을 해지할 수 있음을 상법 및 해당 약관에 규정하고 있으므로 본건 보험계약 해지는 정당함."]
# texts = ["(1) 보험계약의 체결 등 신청인은 2012. 9. 12. 피신청인과의 사이에 자신을 보험계약자, 피보험자 및 보험수익자로 하여 보험가입금액은 10억 원, 보험기간은 10년, 납입 기간 및 주기는 일시납, 보험 형태는 즉시 상속형, 278) 연금 지급주기는 1개월로 하는 이 사건 (무) 즉시연금 계약(이하이 사건 연금보험계약이라 한다)을 체결하였다. 신청인은 이 사건 보험계약에 따라 2012. 10.부터 2013. 9. 까지는 매월 약 305만 원, 2013. 10.부터 2014. 9. 까지는 매월 약 259만 원, 2014. 10.부터 2015. 9. 까지는 매월 약 250만 원, 2015. 10.부터 2016. 9. 까지는 매월 약 184만 원, 2016. 10.부터 2017. 9. 까지는 매월 약 138만 원, 2017. 10.에는 약 136만 원의 생존연금 279)을 수령하였으며, 이와 별도로 이 사건 보험계약 만기인 2022. 9. 11. 납입 278) 보험계약 체결 시 보험료 전액을 일시에 납부하고 납입 익월부터 연금을 수령한다. 비교적 고액으로 운영하므로 보험기간 중에는 이자만으로 연금(생존연금)을 수령하다가 만기 시 원금 상당액(만기보험금)을 환급받게 되므로 원금 상당액을 보전하였다가 상속하는데 유리하다. 즉시 상속형이라는 표현은 이러한 특성이 반영된 것이다. 279) 이 사건 보험계약은 보장계약과 연금 계약으로 구성된다. 보장계약은 보험기간 중 피보험자 사망 시 사망보험금을 지급받기 위한 계약이며, 연금 계약은 보험기간 중에는 매월 생존연금을, 만기 시에는 납입보험료 총액에 상응하는 만기보험금을 지급받기 위한 계약이다. 455(무) 즉시연금보험 1종(즉시형) 약관제3조 (계약의 체결 및 보험료) 1. 계약자는 다음에 정하는 보장계약과 연금 계약을 동시에 체결하여야 합니다. (이하, 보장계약과 연금 계약을 합하여 계약이라 합니다.) 1. 보장계약 : 보험기간 중 피보험자가 제13조 제2호에 정한 사망보험금을 지급받기 위한 계약 2. 연금 계약 : 보험기간 중 피보험자가 제13조 제1호 및 제3호에서 정한 생존연금 및 만개 보험금을 지급받기 위한 계약 제13조 (보험금의 종류 및 지급사유) 회사는 피보험자에게 다음 중 어느 한 가지의 경우에 해당되는 사유가 발생한 때에는 보험수익자에게 약정한 보험금(별표 1 보험금 지급 기준표 참조)을 지급합니다. 1. 보험기간 중 피보험자가 매년 계약 해당 일에 살아 있을 때 : 연금 지급 형태에 따라 매월 생존연금 2. 상속연금형의 경우 보험기간 중 피보험자가 사망하였을 때 : 사망보험금 3. 상속연금형의 경우 보험기간이 끝날 때까지 피보험자가 살아 있을 때 : 만기보험금제16조(공시이율의 적용 및 공시) 1. 이 보험의 연금 계약 순보험료에 대한 적립이율은 매월 1일 회사가 정한 공시이율로 하며, 매월 1일부터 당월 말일까지 1개월간 확정 적용합니다. 2. 제1항의 공시이율은 이 보험의 사업 방법이 서에서 정하는 바에 따라 운용자산 이익률과 외부지표금리를 가중평균하여 산출된 공시기준이율에서 향후 예상 수익 등을 고려한 조정률을 가감하여 결정하며, 공시이율은 산출된 공시기준이율의 80120 범위 내에서 정합니다. 보험료 총액(이하, 이미 납입한 보험료 또는 납입원금이라고도 한다) 10억 원을 지급받는다.(2) 보험계약의 약관 등이 사건 분쟁과 관련한 보험약관(이하 이 사건 연금보험약관이라 한다) 등의 조항은 다음과 같다. 이 사건 보험계약에 따른 보험료 및 보험금 구분 납입 보험료 총액(A) 보험금 보장계약  사망보험금 산출에 필요한 보험료(B) 사망보험금 : 납입보험료의 10연금 계약 사업비(C 납입보험료의 5.325) 만기보험금 및 생존연금 재원(DABC) 만기보험금 : 납입 보험료 총액 생존연금 456공시 기준이율 회사의 운용자산 이익률과 시장의 외부지표금리를 아래와 같이 가중평균한 이율을 말합니다. 이때 운용자산 이익률이란 직전 12개월간의 운용자산에 대한 투자영업수익에서 투자영업비용을 차감하여 계산한 이율을 말하며, 외부지표금리란 시중 실세금리를 반영하는 것으로서 직전 3개월간의 국고채 수익률(5년), 회사채수익률(AAA, 3년), 통화안정증권 수익률(1년)을 혼합한 이율을 말합니다. 공시기준이율운용자산 이익률 0.65 외부지표금리 0.353. 회사는 제1항 및 제2항에서 정한 공시이율 및 산출 방법 등을 매월 회사의 인터넷 홈페이지 등을 통해 공시합니다. 제17조(해지환급금) 1. 이 약관에 의해 계약이 해지된 경우에 지급하는 해지환급금은 산출 방법 서애 따라 계산합니다. 2. 해지환급금 계산 시 적용되는 공시이율(가입 후 10년 이내에는 연 복리 2.5, 10년을 초과한 경우에는 연 복리 1.5 최저보증, 이하 공시이율이라 합니다)은 제16조(공시이율의 적용 및 공시)에서 정한 이율로 합니다. 3. 상속연금형의 경우 회사는 경과 기간별 해지환급금에 관한 표를 계약자에게 제공하여 드립니다.(별표 1) 보험금 지급기준표(1) 생존연금(약관 제13조 제1호) : 계약자가 선택한 연금 지급 형태에 따라 다음과 같이 연금을 지급합니다. 연금 지급 형태 지급사유 지급금액 상속연금형 피보험자가 보험기간(10년, 15년, 20년, 30년) 중 매년 계약 해당 일에 살아있을 때 보장개시일로부터 만 1개월 이후 계약 해당 일부터 연금 지급 개시 시의 연급계약의 적립액을 기준으로 계산한 연금월액을 매월 계약 해당일에 지급(2) 사망보험금 (약관 제13조 제2호) 상속 연금 형만 지급지급 사유 피보험자가 보험기간 중 사망하였을 때 지급금액 이미 납입한 보험료의 10  사망 당시 연금 계약 적립액(3) 만기보험금 (약관 제13조 제3호) 상속 연금 형만 지급 상속연금형(만기형) 지급사유 피보험자가 보험기간이 끝날 때까지 살아있을 때 지급금액 연금 계약 적립액 (이미 납입한 보험료 해당액) 457주) 1. 생존연금의 계산은 공시이율을 적용하여 계산되기 때문에 공시이율이 변경되면 생존연금도 변경됩니다. 6. 연금 계약 적립액은 이 보험의 산출 방법이 서에서 정한 바에 따라 계산한 금액으로 합니다. 7. 공시이율(가입 후 10년 이내에는 연 복리 2.5, 10년을 초과한 경우에는 연 복리 1.5를 최저보증)은 매월 1일 회사가 정한 이율로 합니다. 약관 서두 보험금 지급 관련 특히 유의할 사항 주계약 관련 유의할 사항 연금 계약 적립액이란 연금 개시 전에는 연금 계약 순 보험료(사망보장이 있는 경우 납입하신 보험료 중 보장을 위한 보험료 및 예정 사업비를 차감한 금액)를 공시이율로 납입일부 터 일자 계산에 의하여 적립한 금액이며, 연금 개시 후에는 생존연금 발생분을 차감한 금액입니다. 상품설명서 1. 가입자 유 의사항가. 보험계약 관련 특히 유의할 사항 이 보험은 적용이율(공시이율)이 변동하는 금리 연동형 보험이므로 연금 계약 적립액, 생존연금 및 해지환급금이 공시이율 변동에 따라 변동됩니다. 나. 보험금 지급 관련 특히 유의할 사항 연금 계약 적립액은 연금 개시 전에는 연금 계약 순 보험료(납입하신 보험료 중 사망보장이 있는 경우 보장계약의 보험료 및 예정 사업비를 차감한 금액)를 공시이율로 납입일부 터 일자 계산에 의하여 적립한 금액이며 연금 개시 후에는 생존연금 발생분을 차감한 금액입니다. 4. 보험계약의 주요 보장 내 역 구분 지급사유 지급금액 사망 시 현금 개시 전(거치형에 한함) 연금 개시 후(상속형에 한함) 10,000만 원 사망 당시 연금 계약 적립액 만기 생존 시(상속연금형에 한함) 100,000만 원 지급사유 지급금액 상속연금형 피보험자가 보험기간(10년, 15년, 20년, 30년) 중 매년 계약 해당 일에 살아있을 때 보장개시일로부터 만 1개월 이후 계약 해당 일부터 연금 지급 개시 시의 연금 계약의 적립액을 기준으로 계산한 연금월액을 매월 계약 해당일에 지급 458연금 지급 형태 지급사유 지급금액 상속연금형 피보험자가 보험기간(10년, 15년, 20년, 30년) 중 매년 계약 해당 일에 살아있을 때 보장개시일로부터 만 1개월 이후 계약 해당 일부터 연금 지급 개시 시의 연금 계약의 적립액을 기준으로 계산한 연금월액을 매월 계약 해당일에 지급 5. 보험금 지급 관련 특히 유의할 사항 상속연금형의 경우 피보험자가 보험기간 중 매년 보험계약 해당일에 생존 시 생존연금이 지급되며 보험기간 중 사망 시에는 사망보험금 지급 후 계약이 소멸됩니다. 6. 보험계약 관련 특히 유의할 사항가. 보험계약 관련 유의사항 이 보험계약은 보장 기능이 있고 납입보험료에 보험회사가 경비로 사용하는 사업비가 포함되어 있는 연금보험상품으로 은행의 연금신탁 또는 예금, 적금과는 다릅니다. 라. 보험료 산출기초에 관한 사항 예정이율이 보험의 보장부분에 적용한 예정이율은 연 복리 3.5입니다. 연금 계약 적립액에 적용되는 공시이율은 회사의 운용자산 이익률 등에 따라 변동되면 2012년 9월 현재 연 복리 4.5이며, 최저보증이율은 가입 후 10년 이내에는 연 복리 2.5, 10년 초과 시에는 연 복리 1.5입니다. 가입설계서(양식) 280) 연금 지급 형태 연금 지급 형태별 연금월액 예시( ) 연금 지급 개시 연 복리  최저보증이율(10년 이내 연 복리 2.5, 10년 초과 연 복리 1.5) 상속연금형(10년 만기) 상기 예시된 연금 지급액은 계약일 현재 공시이율 및 최저보증이율(가입 후 10년 이내 연 복리 2.5, 10년 초과 연 복리 1.5)이 계속하여 유지됨을 가정하여 산출한 1차년도 연금월액입니다. 따라서 향후 공시이율이 변동하거나 추가납입 및 중도인출이 있는 경우에는 차 아기 있을 수 있습니다. 연금 계약 적립액은 연금 개시 전에는 연금 계약 순 보험료(납입하신 보험료 중 사망보장이 있는 경우 보장계약의 보험료 및 예정 사업비를 차감한 금액)를 공시이율로 납입 일부터 일자 계산에 의하여 적립한 금액이며 연금 개시 후에는 생존연금 발생분을 차감한 금액입니다. 459연금액 예시 공시이율 연( )인 경우 최저보증이율인 경우(10년 이내 연 2.5, 10년 초과 연 1.5) 매월 만원 만 원 연간 총 수령 예상액 만원 만 원세까지 총 수령 예상액 만원 만원 즉시형의 경우 연금 계약 순 보험료(납입하신 보험료 중 사망보장이 있는 경우 보장계약의 보험료 및 예정 사업비를 차감한 금액)를 상기 공시이율로 계속 유지된다는 가장 하에 산출된 금액입니다. 보험료 및 책임준비금 산출방법서 7. 책임준비금(적립액) 계산에 관한 사항이나. 연금 계약의 적립액 상속연금형 상법 제638조의 3(보험약관의 교부 설명 의무) 1. 보험자는 보험계약을 체결할 때에 보험계약자에게 보험약관을 교부하고 그 약관의 중요한 내용을 설명하여야 한다. 2. 보험자가 제1항을 위반한 경우 보험계약자는 보험계약이 성립한 날부터 3개월 이내에 그 계약을 취소할 수 있다. 약관의 규제에 관한 법률 제2조 (정의) 이 법에서 사용하는 용어의 정의는 다음과 같다.1. 약관이란 그 명칭이나 형태 또는 범위에 상관없이 계약의 한쪽 당사자가 여러 명의 상대방과 계약을 체결하기 위하여 일정한 형식으로 미리 마련한 계약의 내용을 말한다. 제3조(약관의 작성 및 설명의무 등) 1. 사업자는 고객이 약관의 내용을 쉽게 알 수 있도록 한글로 작성하고, 표준화 체계화된 460용어를 사용하며, 약관의 중요한 내용을 부호, 색채, 굵고 큰 문자 등으로 명확하게 표시하여알아보기 쉽게 약관을 작성하여야 한다. 2. 사업자는 계약을 체결할 때에는 고객에게 약관의 내용을 계약의 종류에 따라 일반적으로 예상되는 방법으로 분명하게 밝히고, 고객이 요구할 경우 그 약관의 사본을 고객에게 내주어 고객이 약관의 내용을 알 수 있게 하여야 한다. (단서 생략) 3. 사업자는 약관에 정하여져 있는 중요한 내용을 고객이 이해할 수 있도록 설명하여야 한다. 다만, 계약의 성질상 설명하는 것이 현저하게 곤란한 경우에는 그러하지 아니하다. 4. 사업자가 제2항 및 제3항을 위반하여 계약을 체결한 경우에는 해당 약관을 계약의 내용으로 주장할 수 없다. 제5조(약관의 해석) 1. 약관은 신의성실의 원칙에 따라 공정하게 해석되어야 하며 고객에 따라 다르게 해석되어서는 아니 된다. 2. 약관의 뜻이 명백하지 아니한 경우에는 고객에게 유리하게 해석되어야 한다. 보험업법 제5조(허가 신청서 등의 제출) 제4조 제1항에 따라 허가를 받으려는 자는 신청서에 다음 각호의 서류를 첨부하여 금융위원회에 제출하여야 한다. 다만, 보험회사가 취급하는 보험종목을 추가하려는 경우에는 제1호의 서류는 제출하지 아니할 수 있다. 3. 경영하려는 보험업의 보험종목별 사업방법서, 보험약관, 보험료 및 책임준비금의 산출방법서(이하 기초서류라 한다) 중 대통령령으로 정하는 서류 4. 제1호부터 제3호까지의 규정에 따른 서류 이외에 대통령령으로 정하는 서류"]
docs = [Document(page_content=t) for t in texts[:3]]

summary_chain = load_summarize_chain(llm,
                                     chain_type="map_reduce",
                                     # prompt=PROMPT,
                                     return_intermediate_steps=True,
                                     map_prompt=PROMPT,
                                     combine_prompt=PROMPT
                                     )
output = summary_chain({"input_documents": docs}, return_only_outputs=True)

print(output['output_text'])